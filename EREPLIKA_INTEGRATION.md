# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å bot.e-replika.ru API

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è API

–°–æ–∑–¥–∞–Ω –∫–ª–∞—Å—Å `EReplikaApi` (`backend/src/integrations/ereplika/api.ts`):
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ `Bearer test_token_123`
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ñ–æ–Ω–¥–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —Ñ–æ–Ω–¥–µ
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ñ–æ–Ω–¥–æ–≤ —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö
- ‚úÖ Health check –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### 2. –°–µ—Ä–≤–∏—Å —Ñ–æ–Ω–¥–æ–≤

–û–±–Ω–æ–≤–ª–µ–Ω `FundsService` (`backend/src/services/funds.ts`):
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö: EReplika API ‚Üí Elasticsearch ‚Üí –õ–æ–∫–∞–ª—å–Ω–∞—è –ë–î
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ñ–æ–Ω–¥–æ–≤ –∏–∑ EReplika

### 3. API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

**–ü—É–±–ª–∏—á–Ω—ã–µ:**
- `GET /api/v1/funds` - —Å–ø–∏—Å–æ–∫ —Ñ–æ–Ω–¥–æ–≤ (—Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º EReplika API)
- `GET /api/v1/funds/:id` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–æ–Ω–¥–µ

**–ê–¥–º–∏–Ω:**
- `POST /api/v1/funds/sync` - —Ä—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ñ–æ–Ω–¥–æ–≤ –∏–∑ EReplika

### 4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å EReplika API
2. –ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ñ–æ–Ω–¥–æ–≤
3. –ü–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è Elasticsearch
4. –û—à–∏–±–∫–∏ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## üìã –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í `backend/.env`:
```env
API_TOKEN=test_token_123
BOT_E_REPLIKA_URL=https://bot.e-replika.ru
```

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ EReplika API –∏—Å–ø–æ–ª—å–∑—É—é—Ç:
```
Authorization: Bearer test_token_123
```

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ backend —Å–µ—Ä–≤–µ—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ API –¥–æ—Å—Ç—É–ø–µ–Ω).

### –†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (–∞–¥–º–∏–Ω)

```bash
curl -X POST "http://localhost:3000/api/v1/funds/sync" \
  -H "Authorization: Bearer test_token_123" \
  -H "X-Admin-API-Key: your_admin_key" \
  -H "X-Telegram-Init-Data: your_telegram_init_data"
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–æ–Ω–¥–æ–≤

```bash
# –°–ø–∏—Å–æ–∫ —Ñ–æ–Ω–¥–æ–≤ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∏—Ç –∏–∑ EReplika –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)
curl "http://localhost:3000/api/v1/funds?country=RU&purpose=mosque" \
  -H "X-Telegram-Init-Data: your_telegram_init_data"

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–æ–Ω–¥–µ
curl "http://localhost:3000/api/v1/funds/fund_id" \
  -H "X-Telegram-Init-Data: your_telegram_init_data"
```

## üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ñ–æ–Ω–¥–æ–≤

1. **EReplika API** (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
   - –ó–∞–ø—Ä–æ—Å –∫ `https://bot.e-replika.ru/api/funds`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `test_token_123` –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
   - –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ

2. **Elasticsearch** (–µ—Å–ª–∏ EReplika –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
   - –ü–æ–∏—Å–∫ –≤ –∏–Ω–¥–µ–∫—Å–µ `funds`
   - –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ

3. **–õ–æ–∫–∞–ª—å–Ω–∞—è –ë–î** (fallback)
   - –ó–∞–ø—Ä–æ—Å –∫ —Ç–∞–±–ª–∏—Ü–µ `funds`
   - –í—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–æ –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–∞—Ä–∏–∞–Ω—Ç

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ñ–æ–Ω–¥–æ–≤

1. –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ñ–æ–Ω–¥–æ–≤ –∏–∑ EReplika API
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–æ–Ω–¥–∞:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
   - –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ
   - –ï—Å–ª–∏ –µ—Å—Ç—å ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Elasticsearch –∏–Ω–¥–µ–∫—Å–∞

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –§–æ–Ω–¥ –∏–∑ EReplika API

```typescript
{
  id: string
  name: string
  description?: string
  short_desc?: string
  country_code?: string
  country?: string
  purposes?: string[]
  purpose?: string
  categories?: string[]
  verified?: boolean
  partner_enabled?: boolean
  logo_url?: string
  logo?: string
  website?: string
  social_links?: Record<string, string>
  active?: boolean
}
```

### –ú–∞–ø–ø–∏–Ω–≥ –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –ø–æ–ª–µ–π:
- `description` –∏–ª–∏ `short_desc` ‚Üí `short_desc`
- `country_code` –∏–ª–∏ `country` ‚Üí `country_code`
- `purposes` –∏–ª–∏ `[purpose]` ‚Üí `purposes`
- `logo_url` –∏–ª–∏ `logo` ‚Üí `logo_url`

## ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- **API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é –ë–î
- **–û—à–∏–±–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**: –õ–æ–≥–∏—Ä—É—é—Ç—Å—è, –Ω–æ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç –ø—Ä–æ—Ü–µ—Å—Å
- **–û—à–∏–±–∫–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ–æ–Ω–¥–æ–≤**: –ü—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è, –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è
- **Timeout**: 30 —Å–µ–∫—É–Ω–¥, –∑–∞—Ç–µ–º fallback

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API –ª–æ–≥–∏—Ä—É—é—Ç—Å—è (—É—Ä–æ–≤–µ–Ω—å DEBUG)
- –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è (—É—Ä–æ–≤–µ–Ω—å ERROR)
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è (—É—Ä–æ–≤–µ–Ω—å INFO)

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å bot.e-replika.ru –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

