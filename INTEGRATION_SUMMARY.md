# –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### 1. bot.e-replika.ru API

**–ü—É—Ç—å:** `backend/src/integrations/ereplika/api.ts`

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:**
- –¢–æ–∫–µ–Ω: `test_token_123`
- –ó–∞–≥–æ–ª–æ–≤–æ–∫: `Authorization: Bearer test_token_123`

**–ú–µ—Ç–æ–¥—ã:**
- ‚úÖ `getFunds(params)` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ñ–æ–Ω–¥–æ–≤
- ‚úÖ `getFund(id)` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–æ–Ω–¥–∞ –ø–æ ID
- ‚úÖ `syncFunds()` - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ñ–æ–Ω–¥–æ–≤ —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
- ‚úÖ `getUser(userId)` - –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- ‚úÖ `healthCheck()` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:**
1. **EReplika API** (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
2. **Elasticsearch** (–µ—Å–ª–∏ EReplika –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
3. **–õ–æ–∫–∞–ª—å–Ω–∞—è –ë–î** (fallback)

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:**
- –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Ñ–æ–Ω–¥—ã –∏–∑ EReplika API
- –ü–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è Elasticsearch –∏–Ω–¥–µ–∫—Å
- –û—à–∏–±–∫–∏ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (–∞–¥–º–∏–Ω):**
```
POST /api/v1/funds/sync
Headers:
  Authorization: Bearer test_token_123
  X-Admin-API-Key: your_admin_key
```

### 2. –ü–ª–∞—Ç–µ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã

**YooKassa:**
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
- ‚úÖ Webhooks –æ–±—Ä–∞–±–æ—Ç–∫–∞
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–µ–π

**CloudPayments:**
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
- ‚úÖ Webhooks –æ–±—Ä–∞–±–æ—Ç–∫–∞
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–µ–π

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞:**
- –ü–æ BIN –∫–∞—Ä—Ç—ã (–ø–µ—Ä–≤—ã–µ 6-8 —Ü–∏—Ñ—Ä)
- –†–§ –∫–∞—Ä—Ç—ã ‚Üí YooKassa
- –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ ‚Üí CloudPayments

### 3. Telegram Bot

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ (/start, /sadaqa, /support, /zakat, /subscribe)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ callback_query (inline-–∫–Ω–æ–ø–∫–∏)
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–ª–∞—Ç–µ–∂–∞—Ö
- ‚úÖ Webhook –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

### 4. Elasticsearch

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ –¥–ª—è —Ñ–æ–Ω–¥–æ–≤
- ‚úÖ –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ñ–æ–Ω–¥–æ–≤
- ‚úÖ –ü–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

## üìã API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –§–æ–Ω–¥—ã

- `GET /api/v1/funds` - –°–ø–∏—Å–æ–∫ —Ñ–æ–Ω–¥–æ–≤ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç EReplika API)
- `GET /api/v1/funds/:id` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–æ–Ω–¥–µ
- `POST /api/v1/funds/sync` - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏–∑ EReplika (–∞–¥–º–∏–Ω)

### –ü–ª–∞—Ç–µ–∂–∏

- `POST /api/v1/payments/webhook/yookassa` - Webhook –æ—Ç YooKassa
- `POST /api/v1/payments/webhook/cloudpayments` - Webhook –æ—Ç CloudPayments

### Telegram

- `POST /api/v1/telegram/webhook` - Webhook –æ—Ç Telegram Bot
- `GET /api/v1/telegram/set-webhook` - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# EReplika API
API_TOKEN=test_token_123
BOT_E_REPLIKA_URL=https://bot.e-replika.ru

# –ü–ª–∞—Ç–µ–∂–∏
YOOKASSA_SHOP_ID=your_shop_id
YOOKASSA_SECRET_KEY=your_secret_key
CLOUDPAYMENTS_PUBLIC_ID=your_public_id
CLOUDPAYMENTS_SECRET_KEY=your_secret_key

# Telegram
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_WEBAPP_SECRET=your_webapp_secret

# Elasticsearch
ELASTICSEARCH_URL=http://localhost:9200
```

## üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–æ–Ω–¥–æ–≤

1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ EReplika API
2. –ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –∑–∞–ø—Ä–æ—Å –∫ API
3. –ï—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ Elasticsearch
4. –ï—Å–ª–∏ Elasticsearch –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –ª–æ–∫–∞–ª—å–Ω–∞—è –ë–î

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

1. –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ñ–æ–Ω–¥–æ–≤ –∏–∑ EReplika API
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–æ–Ω–¥–∞:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
   - –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ
   - –ï—Å–ª–∏ –µ—Å—Ç—å ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Elasticsearch –∏–Ω–¥–µ–∫—Å–∞

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–í—Å–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

