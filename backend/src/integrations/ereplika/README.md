# Интеграция с API bot.e-replika.ru

## Описание

Интеграция с внешним API платформы Духовных Практик для получения данных о фондах и синхронизации с локальной базой данных.

## Конфигурация

### Переменные окружения

```env
API_TOKEN=test_token_123
BOT_E_REPLIKA_URL=https://bot.e-replika.ru
```

### Авторизация

Все запросы к API используют Bearer токен в заголовке `Authorization`:
```
Authorization: Bearer test_token_123
```

## Использование

### Автоматическая синхронизация

При запуске приложения автоматически выполняется синхронизация фондов из EReplika API (если API доступен).

### Ручная синхронизация (админ)

```bash
# POST /api/v1/funds/sync
curl -X POST "http://localhost:3000/api/v1/funds/sync" \
  -H "Authorization: Bearer test_token_123" \
  -H "X-Admin-API-Key: your_admin_key"
```

### Получение фондов

При запросе списка фондов система:
1. Сначала пытается получить из EReplika API
2. Если недоступно → пытается Elasticsearch
3. Если недоступно → использует локальную базу данных

## API методы

### `EReplikaApi.getFunds(params)`
Получить список фондов с фильтрами.

### `EReplikaApi.getFund(id)`
Получить информацию о конкретном фонде.

### `EReplikaApi.syncFunds()`
Синхронизировать фонды с локальной базой данных.

### `EReplikaApi.getUser(userId)`
Получить информацию о пользователе.

### `EReplikaApi.healthCheck()`
Проверить доступность API.

## Обработка ошибок

- Если EReplika API недоступен, система автоматически переключается на локальную базу данных
- Все ошибки логируются, но не прерывают работу приложения
- При синхронизации ошибки отдельных фондов не прерывают общий процесс

## Логирование

Все запросы к API логируются на уровне DEBUG.
Ошибки логируются на уровне ERROR.

